-- NOTE THIS SCRIPT MAY TAKE A VERY LONG TIME TO RUN (more than 90 minutes)

-- give everyone a random surname
DECLARE cur CURSOR FOR
  SELECT PersonNameId
         FROM   tblPersonName
			
DECLARE @personNameId int
DECLARE @rnd int

OPEN cur
FETCH NEXT FROM cur INTO @personNameId

WHILE @@FETCH_STATUS = 0
BEGIN
  SELECT @rnd = FLOOR(RAND()*(1000000-10)+10) 
  DECLARE @name varchar(12) =
    Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(@rnd, '1', 'ha'), '2', 'si'), '3', 'mo'), '4', 'fi'), '5', 'tu'), '6', 'we'), '7', 'ka'), '8', 'z'), '9', 'je'), '0', 'la');
  
  UPDATE tblPersonName 
  SET    surname = Upper(LEFT(@name, 1)) 
                 + RIGHT(@name, Len(@name)-1) 
  WHERE  PersonNameId = @personNameId

  FETCH NEXT FROM cur INTO @personNameId
END

CLOSE cur
DEALLOCATE cur

-- give everyone a random birth date
DECLARE cur CURSOR FOR
  SELECT PersonId
         FROM   tblPerson
			
DECLARE @personId int

OPEN cur
FETCH NEXT FROM cur INTO @personId

WHILE @@FETCH_STATUS = 0
BEGIN
  SELECT @rnd = FLOOR(RAND()*(22000-10)+10) 
  
  UPDATE tblPerson 
  SET    BirthDate = dateadd(day, @rnd, '01 Jan 1940')
  WHERE  PersonId = @personId

  FETCH NEXT FROM cur INTO @personId
END

CLOSE cur
DEALLOCATE cur

-- randomise practitioner numbers
DECLARE 
    @alpha varchar(36) = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
    @numeric varchar(36) = '0123456789',
    @n1 int,
    @a1 int,
    @n2 int,
    @a2 int,
    @n3 int,
    @a3 int,
    @pid int

DECLARE personCursor CURSOR FOR
  SELECT PersonId FROM tblPerson
  WHERE PractitionerNumber IS NOT NULL

OPEN personCursor
FETCH NEXT FROM personCursor INTO @pid

WHILE @@FETCH_STATUS = 0
BEGIN
  set @a1 = ABS(CHECKSUM(NEWID()) % 26) + 1
  set @n1 = ABS(CHECKSUM(NEWID()) % 10) + 1
  set @a2 = ABS(CHECKSUM(NEWID()) % 26) + 1
  set @n2 = ABS(CHECKSUM(NEWID()) % 10) + 1
  set @a3 = ABS(CHECKSUM(NEWID()) % 26) + 1
  set @n3 = ABS(CHECKSUM(NEWID()) % 10) + 1

  UPDATE tblPerson 
  SET PractitionerNumber = concat('CPN', 
    substring(@numeric, @n1, 1),
    substring(@alpha, @a1, 1),
    substring(@alpha, @a2, 1),
    substring(@numeric, @n2, 1),
    substring(@numeric, @n3, 1),
    substring(@alpha, @a3, 1))
   WHERE PersonId = @pid

  FETCH NEXT FROM personCursor INTO @pid
END    

CLOSE personCursor
DEALLOCATE personCursor

-- sanitise emails for people
;WITH cte 
     AS (SELECT EmailId, GivenName, Surname 
         FROM   tblEmail 
                JOIN tblEntity 
                  ON tblEntity.EntityId = tblEmail.EntityId 
                JOIN tblPerson 
                  ON tblPerson.EntityId = tblEntity.EntityId 
                JOIN vwDistinctPersonName 
                  ON tblPerson.PersonId = vwDistinctPersonName.PersonId 
                JOIN tblPersonName 
                  ON tblPersonName.PersonNameId = vwDistinctPersonName.PersonNameId) 
UPDATE tblEmail 
SET    Email = Replace(GivenName + '.' + Surname, ' ', '') +   CASE WHEN IsPreferredEmail = 1 THEN '' ELSE '2' END + '@altf4solutions.com.au'
FROM   cte 
WHERE  cte.EmailId = tblEmail.EmailId 

-- sanitise emails for institutions
;WITH cte 
     AS (SELECT EmailId, [Name]
         FROM   tblEmail 
                JOIN tblEntity 
                  ON tblEntity.EntityId = tblEmail.EntityId 
                JOIN tblInstitution
                  ON tblInstitution.EntityId = tblEntity.EntityId 
                JOIN vwDistinctInstitutionName
                  ON tblInstitution.InstitutionId = vwDistinctInstitutionName.InstitutionId 
                JOIN tblInstitutionName 
                  ON tblInstitutionName.InstitutionNameId = vwDistinctInstitutionName.InstitutionNameId) 
UPDATE tblEmail 
SET    Email = Replace([Name], ' ', '') +   CASE WHEN IsPreferredEmail = 1 THEN '' ELSE '2' END + '@altf4solutions.com.au'
FROM   cte 
WHERE  cte.EmailId = tblEmail.EmailId 

UPDATE tblEmailMessage 
SET    RecipientEmail = Email, 
	   Bcc = NULL, 
	   cc = NULL, 
	   FromAddress = 'uat.' + FromAddress
FROM   tblEmail 
WHERE  IsPreferredEmail = 1 
       AND EntityId = RecipientEntityId

UPDATE tblAddress 
SET StreetDetails = CONVERT(varchar, AddressId) + ' Goa Way'

UPDATE tblContactPerson 
SET    Email = 'contact'  + Cast(ContactPersonId AS NVARCHAR) + '@altf4solutions.com.au', 
       [Name] = Substring([Name], 1, Charindex(' ', [Name])) + 'Anonymous' 

UPDATE tblPhone SET LocalNumber = 62457999

-- sanitise all person photos - this part takes all the time
UPDATE tblPersonImage
SET Photo = 0x474946383961FA00FA00910000909090D0D0D0B0B0B000000021FF0B584D502044617461584D503C3F787061636B657420626567696E3D22EFBBBF222069643D2257354D304D7043656869487A7265537A4E54637A6B633964223F3E203C783A786D706D65746120786D6C6E733A783D2261646F62653A6E733A6D6574612F2220783A786D70746B3D2241646F626520584D5020436F726520352E332D633031312036362E3134353636312C20323031322F30322F30362D31343A35363A32372020202020202020223E203C7264663A52444620786D6C6E733A7264663D22687474703A2F2F7777772E77332E6F72672F313939392F30322F32322D7264662D73796E7461782D6E7323223E203C7264663A4465736372697074696F6E207264663A61626F75743D222220786D6C6E733A786D703D22687474703A2F2F6E732E61646F62652E636F6D2F7861702F312E302F2220786D6C6E733A786D704D4D3D22687474703A2F2F6E732E61646F62652E636F6D2F7861702F312E302F6D6D2F2220786D6C6E733A73745265663D22687474703A2F2F6E732E61646F62652E636F6D2F7861702F312E302F73547970652F5265736F75726365526566232220786D703A43726561746F72546F6F6C3D2241646F62652050686F746F73686F702043533620284D6163696E746F7368292220786D704D4D3A496E7374616E636549443D22786D702E6969643A36364541373837393933413731314532383743424337454345373535344239372220786D704D4D3A446F63756D656E7449443D22786D702E6469643A3636454137383741393341373131453238374342433745434537353534423937223E203C786D704D4D3A4465726976656446726F6D2073745265663A696E7374616E636549443D22786D702E6969643A3636454137383737393341373131453238374342433745434537353534423937222073745265663A646F63756D656E7449443D22786D702E6469643A3636454137383738393341373131453238374342433745434537353534423937222F3E203C2F7264663A4465736372697074696F6E3E203C2F7264663A5244463E203C2F783A786D706D6574613E203C3F787061636B657420656E643D2272223F3E01FFFEFDFCFBFAF9F8F7F6F5F4F3F2F1F0EFEEEDECEBEAE9E8E7E6E5E4E3E2E1E0DFDEDDDCDBDAD9D8D7D6D5D4D3D2D1D0CFCECDCCCBCAC9C8C7C6C5C4C3C2C1C0BFBEBDBCBBBAB9B8B7B6B5B4B3B2B1B0AFAEADACABAAA9A8A7A6A5A4A3A2A1A09F9E9D9C9B9A999897969594939291908F8E8D8C8B8A898887868584838281807F7E7D7C7B7A797877767574737271706F6E6D6C6B6A696867666564636261605F5E5D5C5B5A595857565554535251504F4E4D4C4B4A494847464544434241403F3E3D3C3B3A393837363534333231302F2E2D2C2B2A292827262524232221201F1E1D1C1B1A191817161514131211100F0E0D0C0B0A090807060504030201000021F90400000000002C00000000FA00FA000002FF8C8FA9CBED0FA39CB4DA8BB3DEBCFB0F86E24896E689A6EACAB6EE0BC7F24CD7F68DE7FACEF7FE0F0C0A87C4A2F1884C2A97CCA6F3098D4AA7D4AAF58ACD6AB7DCAEF70B0E8BC7E4B2F98C4EABD7ECB6FB0D8FCBE7F4BAFD8ECFEBF7FCBEFF0F182838485868788898A8A824D008F0081919D928B0E8E52899A9A9D9684985B9192A2AD9E9B9043A9AAA0A506A4A24B01A2BCBEA1A347B3B5BCB83CB9BAB6BD31BECFB0B032B7CBC5A49CC628CECACAABC7CF24C1D2B5DD25CAD2D1A7DED91BD1DCEE9ED216E3E4AAE017ECE3E996EB1DE2E4FFB2E113F2FDF5DCF708F9FBFDFA09FBF7F0013081C48B06080830813EE63D8D0E1BB88142501AC881152BD8CFF1C01A483D8919DBE5F20438ABC66B2A3B49229CF8D34D5B2E3CB453143EA6259D365AD9C364DE1E4696EA621A03D17FD242A4EE820A445111D651A4E2920A84D0B3DA5BA4D6A9FAB58AB69E5D355A521AE61A97DCD43B6ACB3B378D472B4EA3623DB3A69E31E9B4BC76E46427A310EAADB3718DE388003F31A0CA7B0E15B88DF2CA628E871C4C8921152AEEC2F9062CCC9006DE69CAA319BCFA0B9792E3D4FF41AD2A8C7FD61DD9AD4E9D83A5FD3AEED07F66D7AB977279DED5B9B6A35BA6F0F57137CDBE5E4CF963347E6FCB9B0E8D27B092ADEFA38F1EA7797720FC6F7BB75EFE27111C20E5A3B9BF2B786B29735F67D67F7F2D11DAA9FCA29FE50EA1DEFFFD7A4C87F000628A0463415F88825E8F5D59F1C08FA2460837308A8CB7E24D527A11DF52DB3205619DED121531FB6251E392102F5CE89358DB8878A29B10816730A25A79001BED578C06D3822101B8CE181B6E30240062964654406B4988F0A06A6244C761D49815B4D5ED8D5941C4265A5374841F9818BB164F9D08B5C9AF0D698297809A6990B49A4A60BACA5D9E603A83006679C175042092BACE069679F7EFE0968A0820E4A68A1861E8A68A28A2ECA68A38E3E0A2994782278172569CC49695475D28069A6F96CCA8C979E6602AA09A28ECADF13A7A20A0D23AC2255EA9DAF5215EB04B38605C4AAB70AC683AEBB768783AFBF025BC3B081716AAC619BC60A9BAC592F346B240BD062B6C2B49CA560ED9025645BDAB6DC762BC2B7AD85C0ACB8B87150AEB9E76AA06E6C1DB44BDB06E9C2BB2E05F3D25BAF04F8EA08CFBEFC4E70AFBFF93620F06E00176C9CBE08FFEB40C00B0705C1C306372C71C20457CCB041185BACC0C61377EC71BC0A381C72542097EC6E02288B7C00C92B0BC7E3CB29DB28F3B806B85C33352DE78C9A323CDBFC336A34077D2DCE44577A34679D26CD20D34E3F0D75D4524F4D75D5565F8D75D65A6FCD75D75E7F0D76D8628F4D76D966735600003B

TRUNCATE TABLE tblAuditLog

UPDATE tblEmailTemplate
SET FromAddress = 'uat.' + FromAddress
WHERE FromAddress not like 'uat.%'

UPDATE tblUser 
SET Email =  'User' + CONVERT(varchar, UserId) + '@altf4solutions.com.au'

UPDATE tblUser 
SET UserName =  Email

update tblSystemValue set Value ='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'  where ValueKey = 'SecurePayAccessToken' 
